<title>711</title>
<button onclick="post()">讀取711點位</button>
<button onclick="request()">請求All16-17-18jpg80.json</button>
<script>
var auth,aspx=[]
fetch('https://call-oa.onrender.com/twoTokens').then(res=>res.text()).then(data=>{data=data.split('\n');auth=data[1];console.log(auth)})

function post(){

 fetch("https://cors-rrw.onrender.com/emap.pcsc.com.tw:443/EMapSDK.aspx",
       {method:"POST",headers:{"content-type":"application/x-www-form-urlencoded"},
       body:"commandid=Search0007&x1=120596924&y1=24106647&x2=120607910&y2=24116675"})
 .then(res=>{if(!res.ok)throw new Error(`post error! status:${res.status}`);return res.text()})
 .then(data=>{console.log(data)})
 .catch(e=>console.log(e))
}

function request(){
 const z15={}
 const jsonUrl='https://www.googleapis.com/drive/v3/files/1EG8-IkWAPTiP_GwwDr0tsjEu8Hp33RxO?alt=media'
 fetch(jsonUrl,{headers:{'Authorization':auth}})
 .then(res=>res.json()).then(data=>{let quotient
  for(const x in data[16]){
   const quotient=Math.floor(x/2)
   z15[quotient]=z15[quotient]||{}
   for(const y in data[16][x]){
    z15[quotient][Math.floor(y/2)]=true
   }
  }
  handle(z15)
 }).catch(e=>console.log('請求All16-17-18jpg80.json錯誤',e))

}

function handle(obj){//共30526個
 const power2=Math.pow(2,15)
 for(let x in obj){x=+x
  for(let y in obj[x]){y=+y
   const lon_min=360*x/power2-180,lon_max=360*(x+1)/power2-180
   let n
   n=Math.PI*(1-2*y/power2);lat_max=Math.atan((Math.exp(n)-Math.exp(-n))/2)*180/Math.PI
   n=Math.PI*(1-2*(y+1)/power2);lat_min=Math.atan((Math.exp(n)-Math.exp(-n))/2)*180/Math.PI
   let str=`x1=${lon_min.toFixed(6)}&y1=${lat_min.toFixed(6)}&x2=${lon_max.toFixed(6)}&y2=${lat_max.toFixed(6)}`
   str=str.replace(/\./g,"")
   aspx.push(str)
  }
 }
 console.log(aspx.length)
}




</script>