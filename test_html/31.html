<div>google雲端硬碟about測試</div>
<button onclick="about()">about</button>
<button onclick="list()">list</button>
<button onclick="special()">special</button>
<script>
var token='ya29.a0AfB_byBr-XeJt-Fn7aBise9RlGLVAmKpPGi_Tkpq5QF1a3FxQIfwabKiShvcUYyUfLPo8nYRBXu8Bfx2N_8kKpl44s9smGrDsrWostjefwqEdvoiGWAqBjfVfPHfJfaKShbgWeeRjkRp0KIj6_aNwTo5xMXP-so2V8saCgYKAWQSARESFQHGX2Mij2NCjjpf2JGpmVfPuJv4gQ0170'
var xhr=new XMLHttpRequest()
function about(){
 xhr.open('GET',`https://www.googleapis.com/drive/v3/about?fields=storageQuota`,true)
 xhr.responseType='json'
 xhr.setRequestHeader('Authorization','Bearer '+token)
 xhr.send()
 xhr.onload=()=>{console.log('onload',xhr.response)}
}
function list(){
 xhr.open('GET',`https://www.googleapis.com/drive/v3/files?q='root' in parents and trashed=false&fields=files(mimeType,name)&pageSize=1000`,true)
 xhr.responseType='json'
 xhr.setRequestHeader('Authorization','Bearer '+token)
 xhr.send()
 xhr.onload=()=>{
  console.log(xhr.response.files,xhr.response.files.length)
 }
}

function special(){
 loop('')
 function loop(pageToken){
  xhr.open('GET',`https://www.googleapis.com/drive/v3/files?q='me' in owners and trashed=false&fields=nextPageToken,files(mimeType,name,parents)&pageSize=1000&pageToken=${pageToken}`,true)
  xhr.responseType='json'
  xhr.setRequestHeader('Authorization','Bearer '+token)
  xhr.send()
  xhr.onload=()=>{
     const result=xhr.response.files.filter(item=>!item.parents||item.parents[0].length==19)//!item.parents代表無父目錄(unorganized)；item.parents[0].length==19代表有父目錄(id長度只有19為root)
     console.log(xhr.response.files,result)
     if(xhr.response.nextPageToken){loop(xhr.response.nextPageToken)}
  }//onload
 }//loop
}//special

</script>