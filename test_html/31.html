<div>google雲端硬碟about測試</div>
<button onclick="about()">about</button>
<button onclick="root()">root</button>
<button onclick="special()">special</button>
<button onclick="trash()">trash</button>
<button onclick="test()">test</button>
<script>
var token='ya29.a0AfB_byBoZ-6sP9bu03V8nl5RiiFDhH_gSVQ-Hj6ayt0X5WJg0GgWZrTw99j8PTaLTXuuMB_ILIlak3PZqxdL44B8OG9RYquWuCXBSCf1itGPdWiIMGcBs4hR-7-UyKhSb53gJnUaRnqj0KJ8yLiPlFRQ6M0mEPztF3nQaCgYKAY4SARESFQHGX2MihHE1lTBmy-c3IHwJ6rF5zg0171'
var xhr=new XMLHttpRequest()
function about(){
 xhr.open('GET',`https://www.googleapis.com/drive/v3/about?fields=storageQuota`,true)
 xhr.responseType='json'
 xhr.setRequestHeader('Authorization','Bearer '+token)
 xhr.send()
 xhr.onload=()=>{console.log('onload',xhr.response)}
}
function root(){
 xhr.open('GET',`https://www.googleapis.com/drive/v3/files?q='root' in parents and trashed=false&fields=files(mimeType,name)&pageSize=1000`,true)
 xhr.responseType='json'
 xhr.setRequestHeader('Authorization','Bearer '+token)
 xhr.send()
 xhr.onload=()=>{
  console.log(xhr.response.files)
 }
}
function special(){
 let result=[]
 loop('')
 function loop(pageToken){
  xhr.open('GET',`https://www.googleapis.com/drive/v3/files?q='me' in owners and trashed=false&fields=nextPageToken,files(mimeType,name,parents)&pageSize=1000&pageToken=${pageToken}`,true)
  xhr.responseType='json'
  xhr.setRequestHeader('Authorization','Bearer '+token)
  xhr.send()
  xhr.onload=()=>{
   console.log(xhr.response.files)
   result=result.concat(xhr.response.files.filter(item=>!item.parents||item.parents[0].length==19))//!item.parents代表無父目錄(unorganized)；item.parents[0].length==19代表有父目錄(id長度只有19為root)
   if(xhr.response.nextPageToken){loop(xhr.response.nextPageToken)}else{console.log(result)}
  }//onload
 }//loop
}//special
function trash(){
 let result=[]
 loop('')
 function loop(pageToken){
  xhr.open('GET',`https://www.googleapis.com/drive/v3/files?q=trashed=true&fields=nextPageToken,files(mimeType,name,parents)&pageSize=1000&pageToken=${pageToken}`,true)
  xhr.responseType='json'
  xhr.setRequestHeader('Authorization','Bearer '+token)
  xhr.send()
  xhr.onload=()=>{
   console.log(xhr.response.files)
   result=result.concat(xhr.response.files)
   if(xhr.response.nextPageToken){loop(xhr.response.nextPageToken)}else{console.log(result)}
  }//onload
 }//loop
}//trash
async function test(){
 const oldId='1N__5vR2pwHDNDgTic7DHPSjr44lo3W5f'
 let res=await fetch(`https://www.googleapis.com/drive/v3/files/${oldId}?fields=*`,{headers:{'Authorization':'Bearer '+token}})
 const{mimeType,name,parents,modifiedTime,id,permissions}=await res.json()
 permissions[0].role="writer"
 res=await fetch(`https://www.googleapis.com/drive/v3/files`,{method:"POST",headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},
 body:JSON.stringify({mimeType:mimeType,name:name,parents:parents,modifiedTime:modifiedTime,folderColorRgb:"#f83a22",permissions:permissions})})
 const newId=(await res.json()).id
 
 console.log(newId)
 //PATCH https://www.googleapis.com/drive/v3/files/FILE_ID/permissions/PERMISSION_ID
 //POST https://www.googleapis.com/drive/v2/files/{fileId}/permissions
 //https://www.googleapis.com/drive/v3/files/{fileId}/permissions
 
 //res=await fetch(`https://www.googleapis.com/drive/v3/files/${newId}/permissions`,{method:"GET",headers:{'Authorization':'Bearer '+token}})
 //console.log(await res.json())
 /*
 await fetch(`https://www.googleapis.com/drive/v3/files/${newId}/permissions/anyoneWithLink`,{method:"PATCH",headers:{'Authorization':'Bearer '+token,'Content-Type':'application/json'},
 body:JSON.stringify({role:'writer'})})
*/
}

</script>